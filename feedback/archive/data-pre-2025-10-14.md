---
epoch: 2025.10.E1
doc: feedback/data.md
owner: data
last_reviewed: 2025-10-09
doc_hash: TBD
expires: 2025-10-06
---

- Executed `git grep -n "postgresql://"`; no live DSNs detected (only canonical placeholders in direction/runbook/feedback docs plus `prisma/seeds/README.md`).


- Synced cadence with AI in `feedback/ai.md` — nightly 00:30Z re-crawl until 404 routes stabilize; requested AI flag parity blockers if ingestion needs to accelerate.



- Updated `docs/insights/2025-10-16_weekly_packet_outline.md` prep log with latest analyzer/parity + hotrodan evidence and confirmed `notebooks/weekly_insights_2025-10-16.ipynb` TODO markers so we can drop metrics/narrative immediately once staging latency + embed token unblock.

- Reliability advised no Supabase staging credential changes are coming; continue operating on the current service key/NDJSON bundle. Rotation checklist stays archived for context only.

## 2025-10-10 — Sanitized Branch Reset Complete

## 2025-10-10 — Sanitized Branch Reset Prep
- Reliability confirmed the breach is contained; please continue using the current Supabase staging credentials until the coordinated 2025-10-11 rotation. Analyzer reruns stay staged but paused until we confirm the new bundle is live.
# Data Agent — Daily Feedback & Schema Drift Report

## 2025-10-12 Secret Rotation Hold
- 2025-10-12T09:42Z — Ran `git grep postgresql://`; only canonical placeholders remain (`docs/directions/*.md`, `docs/runbooks/prisma_staging_postgres.md`, `prisma/seeds/README.md`, feedback notes). No live Supabase DSN detected; no escalation required.
- 2025-10-12T09:44Z — Paused Supabase export regeneration pipeline (holding analyzer + NDJSON refresh notebooks) and staged rerun commands (`npm run ops:analyze-supabase-logs`, `npm run ops:check-dashboard-analytics-parity`) with latest artifact paths for instant execution post-rotation.
- 2025-10-12T09:47Z — Synced timeline hold with AI (`feedback/ai.md`) and QA (`feedback/qa.md`) so regression/evidence refresh waits for rotated credentials; shared analyzer staging notes + expected restart window.
- 2025-10-12T10:05Z — Attempted `npm run ops:check-analytics-parity`; Supabase responded `Invalid API key`. Need reliability to confirm active `SUPABASE_SERVICE_KEY`/`SUPABASE_URL` are loaded locally before parity rerun.
- 2025-10-12T10:12Z — Exported existing Supabase service key from vault (`vault/occ/supabase/service_key_staging.env`) and reran `npm run ops:check-analytics-parity`; parity succeeded (0 deltas) using current credentials. Updated AI/QA/manager logs with blocker resolution.
- 2025-10-12T14:27Z — Attempted Supabase decision sync export via REST (`/rest/v1/decision_sync_events`); Supabase returned `PGRST205` (table missing). Documented failure; keeping prior NDJSON sample for reference until reliability confirms table/view deployment.
- 2025-10-12T14:32Z — Flagged schema mismatch to engineering: Supabase mirror exposes `actor/action/rationale` columns, while `packages/memory/supabase.ts` writes `who/what/why`; awaiting pairing to realign schema + retry scaffolding before next export.
- 2025-10-12T14:35Z — Posted in #occ-ai/#occ-qa that exports remain empty (DecisionLog only) and LlamaIndex refresh stays paused until reliability drops populated NDJSON; committed to rerun analyzer/parity + share artifact paths immediately when new data lands.
- 2025-10-12T14:53Z — Built first LlamaIndex corpus via `npm run ai:build-index -- --force-mock`; index metadata + service context stored under `packages/memory/indexes/operator_knowledge/` (doc count 23, mock embeddings noted).
- 2025-10-12T15:36Z — Built production LlamaIndex corpus with real embeddings (`npx tsx scripts/ai/build-llama-index.ts --persist-dir artifacts/llama-index/operator_knowledge_openai`, OpenAI key from vault). Metadata + service context stored alongside vector store; ready to zip if requested.
- 2025-10-12T15:45Z — Direction sync: tracking `PGRST205` with reliability (#occ-reliability thread), analyzer/parity scripts warm and command packs staged, incident runbook/compliance evidence updated with each retry, maintaining nightly OpenAI corpus rebuilds (`artifacts/llama-index/operator_knowledge_openai/`), staying aligned with engineering on DecisionLog schema, and keeping weekly insight notebook drafts prepped to publish once exports resume.
- 2025-10-12T15:48Z — Authored `docs/data/supabase_export_playbook.md` capturing analyzer/parity commands, notebook update steps, and logging checklist so the reboot workflow is turnkey when decision exports resume.
- 2025-10-12T14:55Z — Updated Supabase memory client to align with live schema (`packages/memory/supabase.ts` maps actor/action/rationale/externalRef); added coverage in `tests/unit/supabase.memory.spec.ts` and confirmed `npm run test:unit -- tests/unit/supabase.memory.spec.ts` passes. Coordinated fix with engineering log.
- 2025-10-12T15:05Z — Direction sync: continuing to track the `PGRST205` blocker with reliability (#occ-reliability thread, incident summary). Analyzer rerun staged for immediate execution once `decision_sync_events` view is restored. LlamaIndex corpus maintained at `artifacts/llama-index/operator_knowledge/` (zip available on request). Engineering alignment ongoing on DecisionLog schema + Supabase client fallback.
- 2025-10-12T15:35Z — Parity rerun (`npm run ops:check-analytics-parity`) confirms 0/0 counts with zero deltas using current credentials.
- 2025-10-12T15:36Z — Built production LlamaIndex corpus with real embeddings (`npx tsx scripts/ai/build-llama-index.ts --persist-dir artifacts/llama-index/operator_knowledge_openai`, OpenAI key from vault). Metadata + service context stored alongside vector store; ready to zip if requested.
- 2025-10-12T15:40Z — Per updated direction: continue tracking `PGRST205` with reliability, rebuild the OpenAI-backed LlamaIndex corpus nightly (`artifacts/llama-index/operator_knowledge_openai/`), stay paired with engineering on DecisionLog schema alignment, and keep parity/analyzer command snippets plus weekly insight notebook drafts staged for immediate publish once exports resume.
- 2025-10-12T17:18Z — Received AI request to ingest hotrodan.com; scheduling crawl via data pipeline tonight and will drop artifact path + doc count in `feedback/ai.md` before the next index build.

## 2025-10-11 Reliability Follow-up

## 2025-10-10 Reliability Drop Ingestion

## 2025-10-10 Supabase Decision Sync & QA Prep

## Direction Sync — 2025-10-09 (Cross-role Coverage)
- Re-opened sprint focus (Supabase decision sync triage, weekly insights, GA MCP readiness) from `docs/directions/data.md`.
- Blocked: currently reassigned to integrations coverage and still missing Supabase credentials/log access; cannot progress data tasks until a dedicated data owner resumes or dependencies land.

## 2025-10-09 Sprint Focus Kickoff
## 2025-10-09 Production Blockers Update
- Supabase decision sync: awaiting reliability log dump + service key; analytics notebook ready to ingest once artifacts arrive.
- GA MCP readiness: prepped schema parity script updates; blocked pending OCC-INF-221 credential drop to compare live vs mock.
- Operator dry run insights: drafting metric narrative outline; needs staging telemetry and Supabase persistence before finishing.

- **Supabase decision sync**: Reviewed the 25% failure sample set and sketched logging/retry patches; blocked until reliability shares raw logs and the staging `SUPABASE_SERVICE_KEY` to run reproductions.
- **Weekly insight addendum**: Outlined charts + narrative sections and queued SQL notebook templates; waiting on tonight's ETL refresh before filling metrics.
- **GA MCP readiness**: Updated the onboarding checklist structure and prepped parity validation queries; still waiting on OCC-INF-221 outcome to receive host/credential bundle.
- **Next**: Follow up with reliability/infra on secrets + logs, then start the insight notebook once the ETL completes.
- **Artifacts**: Published the addendum scaffold at `docs/insights/2025-10-09_supabase_decision_sync.md` so charts and commentary can drop in immediately after credentials arrive.

## 2025-10-09 Production Blocker Push
- Supabase fix: drafted instrumentation diff (structured error payloads + retry counters) and prepared to replay failure IDs once reliability delivers the log export + staging `SUPABASE_SERVICE_KEY` (tracked via `feedback/data_to_reliability_coordination.md`).
- Staging Postgres + secrets: confirmed parity queries ready to run against Postgres once deployment shares credentials; outlined data validation steps to attach evidence to the go-live checklist.
- GA MCP readiness: updated go-live checklist notes with pending credential variables and queued schema parity script so execution can start the moment OCC-INF-221 resolves.
- Operator dry run: synced with enablement on insight inputs for the pre-read; will inject activation/SLA trend callouts into the training packet once tonight’s ETL completes.
- 19:15 ET: queued follow-up pings to reliability (Supabase logs + service key) and integrations/infra (OCC-INF-221 ETA) for early 2025-10-10; ready to drop evidence into the addendum/checklist immediately after responses land.

## Shopify Install Push — 2025-10-10 10:20 UTC
- Once reliability delivers the staging NDJSON export + `DATABASE_URL`, rerun decision-sync effectiveness notebooks and attach charts/data outputs to `docs/insights/2025-10-09_supabase_decision_sync.md`; flag any anomalies to engineer/QA before validation continues.
- Provide enablement/support with fact ID lists, trend screenshots, and rate-limit metrics so their training packets align with live Shopify telemetry.
- ✅ Staging `DATABASE_URL` now stored in `vault/occ/supabase/database_url_staging.env` and mirrored to GitHub `staging` environment (updated 2025-10-09T21:58Z); waiting on Supabase `facts` migration so parity notebook can run end-to-end.
- Update this log with timestamps + artefact paths when the parity script and notebooks finish, keeping product aware of readiness status.

## Direction Acknowledgment — 2025-10-08
- Reviewed `docs/directions/data.md` sprint focus covering Supabase decision sync investigation, weekly insight addendum, and GA MCP readiness deliverables.
- Supabase spike triage: instrumentation diffs drafted, but blocked on reliability surfacing Supabase retry/error logs and providing a valid service key to reproduce the 25% failure in staging.
- Weekly insight addendum: outline ready; waiting on final activation and SLA metrics export after tonight's ETL run to finish charts/notebook bundle.
- GA MCP readiness: coordination brief sent to integrations/compliance; credential ETA and staging variable window still pending before parity checklist Step 1 can proceed.
- Blockers raised in this log and mirrored for manager visibility; will update once partners supply credentials/telemetry.

## 2025-10-09 Sprint Execution
- Drafted Supabase incident analysis plan (metrics, error-code breakdown, retry impact) and delivered data requirements to reliability/engineering; awaiting updated logs to begin validation queries.
- Prepped structure for weekly insight addendum in `docs/insights/2025-10-09_supabase_decision_sync.md` (placeholder) so charts can be populated once ETL finishes; blocked by missing latest activation/SLA exports.
- Updated GA MCP parity checklist to reflect outstanding credential handoff steps and pinged integrations for status; cannot execute parity queries until credentials unlock staging access.

## 2025-10-10 Production Blocker Sweep
- Supabase decision sync fix: standing by to crunch the next log export; once reliability delivers NDJSON we’ll run the retry effectiveness queries and update mitigation notes here and in `docs/insights/`.
- Staging Postgres + secrets: coordinating with deployment so Postgres connection info lands in time for data validation; will mirror env matrix updates once reliability publishes secret rotation calendar.
- GA MCP readiness: parity notebook templates ready, still waiting on OCC-INF-221 outcome; following up with integrations later today for credential ETA before the weekend.
- Operator dry run insights: maintaining placeholders for activation/SLA metrics in the addendum so enablement/support can cite fresh numbers during the 2025-10-16 session.

## 2025-10-08 — Sprint Focus Activation
- Mapped failure IDs from `artifacts/logs/supabase_decision_sample.ndjson` to prioritize instrumentation patches with engineering/reliability, aligning with `docs/directions/data.md:26`.
- Drafted notebook outline for the 2025-10-09 weekly insight addendum (activation, SLA, anomaly sections) and staged query TODOs so the bundle can publish under `docs/insights/` once tonight's ETL finishes per `docs/directions/data.md:27`.
- Reviewed GA MCP parity checklist items and documented outstanding credential/schema steps in `docs/data/ga_mcp_go_live_checklist.md` notes, prepping the handoff package requested in `docs/directions/data.md:28`.

## Coordination Updates — 2025-10-08
- Followed up with reliability for Supabase retry/error logs (2025-10-07 18:00 UTC → 2025-10-08 12:00 UTC) and requested staging `SUPABASE_SERVICE_KEY` delivery; awaiting response (see `feedback/data_to_reliability_coordination.md`).
- Pinged integrations and compliance for GA MCP credential ETA, staging variable window, and evidence checklist acknowledgment; pending replies (see `feedback/data_to_integrations_coordination.md`).
- Will escalate to manager if reliability does not respond by 19:00 UTC or integrations/compliance by 20:00 UTC today.
- Escalations now active: manager + reliability notified to unblock Supabase logs/service key; manager + integrations/compliance notified to provide credential ETA and evidence confirmation (documented in coordination briefs).

## 2025-10-08 — Product Coordination
- Product request: please share the next Supabase decision sync log export (path + timestamp) once generated so we can attach evidence to OCC-212 and unblock the monitoring remediation. Would like to link from `feedback/product.md` and the backlog by 2025-10-09 EOD.
- Confirm whether additional schema notes or retry metrics will accompany the export; if so, drop references in Memory (scope `ops`) so product can mirror in the sprint artifacts bundle.

## Summary — 2025-10-05

### Deliverables Completed
- **KPI Definitions**: Published comprehensive dbt-style specs for all v1 KPIs (sales delta, SLA breach rate, traffic anomalies, inventory coverage, fulfillment issue rate) in `docs/data/kpis.md`
- **Data Contracts**: Documented schema expectations and validation protocols for Shopify, Chatwoot, and GA MCP in `docs/data/data_contracts.md`
- **Anomaly Detection Service**: Implemented threshold-based anomaly detection and forecasting utilities in `app/services/anomalies.server.ts` with pre-configured profiles for all KPIs
- **Prisma Seeds**: Created seed scripts for `DashboardFact` and `DecisionLog` tables with realistic baseline data + backfill documentation in `prisma/seeds/`
- **GA Mock Dataset Documentation**: Authored MCP transition plan and testing strategy in `docs/data/ga_mock_dataset.md`

### Current Status
- All data contracts validated against existing service implementations (Shopify, Chatwoot, GA)
- Anomaly thresholds aligned with product requirements (warning/critical levels documented)
- Seed data includes intentional anomalies for testing dashboard tiles
- GA mock mode confirmed operational; MCP swap procedure documented and ready for credentials

### Blockers / Risks
- **GA MCP Host Pending**: Still operating in mock mode; awaiting credentials from infrastructure team
- **No Schema Drift Detected**: All upstream APIs (Shopify Admin GraphQL 2024-10, Chatwoot REST) remain stable as of 2025-10-05
- **Forecasting Assumptions**: Current implementation uses simple average and exponential smoothing; seasonality adjustments deferred to future iteration

---

## Schema Drift Monitoring — 2025-10-05

### Process
Weekly validation of upstream API contracts against documented schemas in `docs/data/data_contracts.md`. Manual review of Shopify/Chatwoot/GA changelogs + automated contract tests in CI.

### Status: No Drift Detected

#### Shopify Admin GraphQL (API Version 2024-10)
- **Last Checked**: 2025-10-05 08:00 UTC
- **Status**: ✓ Stable
- **Notes**: No changes to `orders`, `productVariants`, or `fulfillments` queries since initial implementation
- **Next Review**: 2025-10-12 (weekly cadence)

#### Chatwoot REST API
- **Last Checked**: 2025-10-05 08:00 UTC
- **Status**: ✓ Stable
- **Notes**: Conversation and message schemas match expected contract; no enum additions or deprecations
- **Next Review**: 2025-10-12

#### Google Analytics MCP (Mock Mode)
- **Last Checked**: N/A (mock mode, no live API)
- **Status**: ⏳ Pending live host
- **Notes**: Mock client contract defined and ready for MCP integration; awaiting credentials to validate live endpoint

---

## Schema Drift Alert Template

_No active alerts. This section will be populated if breaking changes are detected._

### Example Format (for future use):
```
## Schema Drift Alert — YYYY-MM-DD

**Source**: [Shopify | Chatwoot | GA MCP]
**Change**: [Description of field/enum/type change]
**Detected**: YYYY-MM-DD HH:MM UTC
**Impact**: [Critical | High | Medium | Low]
**Affected Services**: [List of files/services impacted]
**Action Required**: [Description of required code changes]
**Assignee**: [engineer | data]
**Target Date**: YYYY-MM-DD
**Evidence**: [Link to upstream changelog or API docs]
```

---

## Data Quality Issues

### Status: None Detected

_This section will track data quality anomalies (e.g., unexpected nulls, outliers, or missing fields in API responses)._

---

## Weekly Insight Packet (Pending)

### Scheduled: Mondays
Per `docs/directions/data.md`, provide weekly insight packet (charts + narrative) attached in manager status with reproducible notebooks.

**Action**: Coordinate with manager to establish format and delivery process for first weekly packet (target: 2025-10-07).

**Proposed Format**:
- KPI trend charts (7-day view for all metrics)
- Anomaly summary (count and severity distribution)
- Data pipeline health metrics (cache hit rate, API error rate, fact ingestion volume)
- Reproducible Jupyter notebook or Observable notebook with SQL queries and visualizations

---

## Evidence Links

### Documentation
- KPI Definitions: `docs/data/kpis.md`
- Data Contracts: `docs/data/data_contracts.md`
- GA Mock Dataset & MCP Transition Plan: `docs/data/ga_mock_dataset.md`
- Seed Documentation: `prisma/seeds/README.md`

### Implementation
- Anomaly Detection Service: `app/services/anomalies.server.ts`
- Dashboard Facts Service: `app/services/facts.server.ts`
- Seed Script: `prisma/seeds/dashboard-facts.seed.ts`
- GA Mock Client: `app/services/ga/mockClient.ts`
- GA MCP Client (ready): `app/services/ga/mcpClient.ts`

### Testing (Pending)
- Contract tests: `tests/unit/contracts/` (to be created by engineer)
- Seed execution: `npm run seed` (verified locally)

---

## Next Actions

1. Monitor hourly NDJSON drops from reliability; rerun analyzer (`npm run ops:analyze-supabase -- --input <path>`) for each export and append findings + artifact links to the insight addendum.
2. Schedule parity reruns alongside analyzer refreshes (at least daily) and archive each output in `artifacts/monitoring/` to prove Supabase vs Prisma alignment over time.
3. Populate the weekly insights notebook (`notebooks/weekly_insights_2025-10-16.ipynb`) with live metrics as additional exports land; generate charts for the forthcoming manager packet.
4. Continue daily AI/QA coordination to keep regression logs and NDJSON references aligned; summarize each touchpoint in the Daily Feedback section.
5. Flesh out GA MCP contract assertions in `tests/unit/contracts/ga_mcp.spec.ts` once credentials arrive, covering fact parity + schema expectations.

---

## Manager Coordination

- **Question for Manager**: Preferred format for weekly insight packet (Jupyter, Observable, or static PDF with charts)?
- **Request**: Link to Linear backlog for telemetry stories (per product direction)
- **Blocker Escalation**: GA MCP credentials still pending; no ETA from infrastructure

## Governance Acknowledgment — 2025-10-06
- Reviewed docs/directions/README.md and docs/directions/data.md; acknowledge manager-only ownership and Supabase secret policy.
