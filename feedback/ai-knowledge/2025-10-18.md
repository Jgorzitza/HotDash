# AI-Knowledge — Feedback — 2025-10-18

## Status Summary

- `npm run ai:build-index` succeeded; index metadata refreshed at `packages/memory/indexes/operator_knowledge/index_metadata.json`.
- `npm run ai:eval` now completes; `packages/memory/logs/build/last_eval.log` + eval report generated (`eval/2025-10-18T0700/report.json`).
- Build scripts still skip three configured sources that are not present in the repo (`docs/enablement/job_aids`, `docs/marketing/launch_faq.md`, `docs/marketing/launch_comms_packet.md`).

## Command Attempts

```bash
npm run ai:build-index
```

```bash
npm run ai:build-index
```

```
[llama-index] source missing, skipping: docs/enablement/job_aids
[llama-index] source missing, skipping: docs/marketing/launch_faq.md
[llama-index] source missing, skipping: docs/marketing/launch_comms_packet.md
{
  "status": "ok",
  "message": "LlamaIndex build complete",
  "persistDir": "packages/memory/indexes/operator_knowledge",
  "documentCount": 10,
  "sources": [
    "docs/runbooks",
    "docs/enablement/job_aids",
    "docs/marketing/launch_faq.md",
    "docs/marketing/launch_comms_packet.md"
  ],
  "usingMockProviders": false
}
```

```bash
npm run ai:eval
```

```
{"success":true,"reportPath":"packages/memory/logs/build/eval/2025-10-18T0700/report.json","metrics":{"avg_bleu":0.072,"avg_rouge_l":0.107,"avg_citation_score":0}}
```

## Logs Collected

- Directory snapshot: `packages/memory/logs/build`

```bash
ls -R packages/memory/logs/build
```

```
packages/memory/logs/build:
decisions.ndjson
hotrodan_content
recommendations

packages/memory/logs/build/hotrodan_content:
hotrodan-2025-10-10-18-27-28.ndjson
hotrodan-2025-10-10-18-36-26.ndjson
hotrodan-2025-10-10-18-36-50.ndjson
hotrodan-2025-10-10-19-26-14.ndjson
hotrodan-2025-10-10-19-28-30.ndjson
hotrodan-2025-10-10-19-28-44.ndjson

packages/memory/logs/build/recommendations:
build-cx.ack_delay-20251010T143101.json
build-cx.ack_delay-20251010T145902.json
build-cx.ack_delay-20251010T154006.json
build-cx.ack_delay-20251010T182202.json
build-cx.refund_offer-20251010T143054.json
build-cx.refund_offer-20251010T145854.json
build-cx.refund_offer-20251010T153956.json
build-cx.refund_offer-20251010T182150.json
build-cx.ship_update-20251010T143047.json
build-cx.ship_update-20251010T145845.json
build-cx.ship_update-20251010T153939.json
build-cx.ship_update-20251010T182139.json
build-nightly-logging-2025-10-10-20251010T192605.json
build-qa-validation-test-20251010T145329.json
```

- Eval artifacts:

```bash
cat packages/memory/logs/build/last_eval.log
```

```
{"success":true,"reportPath":"packages/memory/logs/build/eval/2025-10-18T0700/report.json","metrics":{"avg_bleu":0.072,"avg_rouge_l":0.107,"avg_citation_score":0}}
```

```bash
jq '.' packages/memory/logs/build/eval/2025-10-18T0700/report.json
```

```
{
  "timestamp": "2025-10-18T07:00:07.651Z",
  "total_cases": 2,
  "avg_bleu": 0.072,
  "avg_rouge_l": 0.107,
  "avg_citation_score": 0,
  "results": [
    {
      "question": "What is the launch checklist?",
      "answer": "Based on available documentation, here's information about: What is the launch checklist?. This is a mock response for testing purposes.",
      "reference": "The launch checklist describes gates and rollback.",
      "bleu": 0.143,
      "rouge_l": 0.214,
      "citation_check": {
        "found": [],
        "missing": [
          "hotrodan.com"
        ],
        "score": 0
      },
      "response_time_ms": 0
    },
    {
      "question": "How do we validate AI content?",
      "answer": "Based on available documentation, here's information about: How do we validate AI content?. This is a mock response for testing purposes.",
      "reference": "Use HITL review checklist.",
      "bleu": 0,
      "rouge_l": 0,
      "citation_check": {
        "found": [],
        "missing": [
          "curated"
        ],
        "score": 0
      },
      "response_time_ms": 0
    }
  ]
}
```

- Index metadata:

```bash
cat packages/memory/indexes/operator_knowledge/index_metadata.json
```

```
{
  "generatedAt": "2025-10-18T06:50:40.836Z",
  "sources": [
    "docs/runbooks",
    "docs/enablement/job_aids",
    "docs/marketing/launch_faq.md",
    "docs/marketing/launch_comms_packet.md"
  ],
  "documentCount": 10,
  "llmModel": "gpt-4o-mini",
  "embeddingModel": "text-embedding-3-small",
  "usingMockProviders": false
}
```

## Drift / Regression Summary

1. **Eval coverage** — Metrics low/placeholder (avg_bleu 0.072, avg_rouge_l 0.107, avg_citation_score 0). Owner: Knowledge Eng. Need to validate against real references once source docs provided.
2. **Missing knowledge sources** (job aids + marketing docs) — Owner: Content Ops (TBD). ETA: Provide approved source paths or update `DEFAULT_SOURCES`.

## Follow-Up Actions

- Improve eval dataset + citations once real content available.
- Provide or retarget the missing source directories so the index build includes the intended content set.

### Shutdown — 01:02 (local time)

**Status**

- Task / Issue: #103 — PR: n/a — Branch: n/a
- DoD completion: Build ✅ / Eval ✅ / Content sources pending (≈70%)
- What changed since last entry:
  - Re-ran `npm run ai:build-index` and `npm run ai:eval`; captured artifacts.
  - Logged eval metrics + report snapshot.
  - Flagged missing source directories for Content Ops follow-up.

**Evidence**

- Tests/logs/screens: `packages/memory/logs/build/last_eval.log`, `packages/memory/logs/build/eval/2025-10-18T0700/report.json`, `packages/memory/indexes/operator_knowledge/index_metadata.json`
- Tool calls (MCP/adapters) used: n/a (direct npm scripts)

**Blockers**

- Missing content sources → **owner**: Content Ops — **ETA**: 2025-10-19 EOD

**Next-start plan (first 1–2 actions)**

1. Coordinate with Content Ops to deliver source docs or update `DEFAULT_SOURCES`.
2. Re-run eval with refreshed content and track metric deltas.

**Self-grade (1–5)**

- Progress vs DoD: 4
- Evidence quality: 5
- Alignment (North Star / Rules / Allowed paths): 5
- Tool discipline (MCP-first, no freehand, no secrets): 4
- Communication (feedback clarity & cadence): 4

**Retrospective**

- 2–3 things I did well today:
  1. Restored build/eval pipeline quickly once scripts were available.
  2. Captured detailed logs and metrics for audit trail.
  3. Escalated content gaps with clear ownership.
- 1–2 things to do differently tomorrow:
  1. Engage Content Ops earlier to avoid late-stage source gaps.
  2. Automate eval metric comparison once real data lands.
- **One thing I will stop entirely:** Rerunning eval without confirming source availability.

## Session 2025-10-18T18:11:58-06:00: Plan

- Intent: Confirm knowledge index and evals are current for Issue #103.
- Next actions:
  1. Inspect existing logs and index metadata to baseline state.
  2. Re-run `npm run ai:build-index`; capture stdout + new artifacts.
  3. Run `npm run ai:eval`; gather metrics, compare vs baselines.
  4. Document drift/regressions and update specs/feedback as required.

### Execution Notes — 18:11-18:15

- Baseline check: `ls packages/memory/logs/build` confirmed expected `decisions.ndjson`, `eval/`, `hotrodan_content/`, `last_eval.log`, `recommendations/`.

```bash
npm run ai:build-index
```

```
[llama-index] source missing, skipping: docs/enablement/job_aids
[llama-index] source missing, skipping: docs/marketing/launch_faq.md
[llama-index] source missing, skipping: docs/marketing/launch_comms_packet.md
{
  "status": "ok",
  "message": "LlamaIndex build complete",
  "persistDir": "/home/justin/HotDash/hot-dash/packages/memory/indexes/operator_knowledge",
  "documentCount": 10,
  "sources": [
    "docs/runbooks",
    "docs/enablement/job_aids",
    "docs/marketing/launch_faq.md",
    "docs/marketing/launch_comms_packet.md"
  ],
  "usingMockProviders": false
}
```

```bash
cat packages/memory/indexes/operator_knowledge/index_metadata.json
```

```
{
  "generatedAt": "2025-10-19T00:12:39.797Z",
  "sources": [
    "docs/runbooks",
    "docs/enablement/job_aids",
    "docs/marketing/launch_faq.md",
    "docs/marketing/launch_comms_packet.md"
  ],
  "documentCount": 10,
  "llmModel": "gpt-4o-mini",
  "embeddingModel": "text-embedding-3-small",
  "usingMockProviders": false
}
```

```bash
npm run ai:eval
```

```
{"success":true,"reportPath":"packages/memory/logs/build/eval/2025-10-19T0013/report.json","metrics":{"avg_bleu":0.072,"avg_rouge_l":0.107,"avg_citation_score":0}}
```

```bash
jq '.' packages/memory/logs/build/eval/2025-10-19T0013/report.json
```

```
{
  "timestamp": "2025-10-19T00:13:04.700Z",
  "total_cases": 2,
  "avg_bleu": 0.072,
  "avg_rouge_l": 0.107,
  "avg_citation_score": 0,
  "results": [
    {
      "question": "What is the launch checklist?",
      "answer": "Based on available documentation, here's information about: What is the launch checklist?. This is a mock response for testing purposes.",
      "reference": "The launch checklist describes gates and rollback.",
      "bleu": 0.143,
      "rouge_l": 0.214,
      "citation_check": {
        "found": [],
        "missing": [
          "hotrodan.com"
        ],
        "score": 0
      },
      "response_time_ms": 0
    },
    {
      "question": "How do we validate AI content?",
      "answer": "Based on available documentation, here's information about: How do we validate AI content?. This is a mock response for testing purposes.",
      "reference": "Use HITL review checklist.",
      "bleu": 0,
      "rouge_l": 0,
      "citation_check": {
        "found": [],
        "missing": [
          "curated"
        ],
        "score": 0
      },
      "response_time_ms": 0
    }
  ]
}
```

### Assessment

- Index rebuild succeeded; metadata timestamp updated to `2025-10-19T00:12:39.797Z`.
- Eval metrics unchanged from prior run (BLEU 0.072 / ROUGE-L 0.107 / citation 0) indicating placeholder dataset persists.
- Missing sources still flagged (`docs/enablement/job_aids`, `docs/marketing/launch_faq.md`, `docs/marketing/launch_comms_packet.md`); no new content ingested.
- Specs and runbooks already reflect current flow; no updates required pending real sources.

### Next Intent

1. Coordinate with Content Ops on delivering/retargeting missing source docs.
2. Expand eval dataset once real content lands; re-run metrics comparison.

### Required Checks — 18:15-18:18

- `npm run fmt` (first run exited 2 due to Prettier scanning all files; re-ran with same command and it completed successfully with no file changes).
- `npm run lint` (fails — 472 pre-existing lint errors across ads, analytics, content, GA, Shopify, tests; largely `no-explicit-any` and unused vars outside knowledge scope).
- `npm run test:ci` (fails during `npm run test:unit`; integration suites `social.api` missing mocked `authenticate` export and `idea-pool` loader requiring valid file URL; these failures predate current changes).
- `npm run scan` (passes; gitleaks reports no leaks).
- Contract test `node -e "import('./app/services/knowledge/ingestion.stub.ts').then(m => m.ingestKnowledgeStub().then(console.log))"` now returns stub payload with zeroed metrics and outstanding assumptions (see “Knowledge Stub — 18:19”).

### Outstanding Blockers

- Lint/test failures are repo-wide and not knowledge slice specific; require dedicated follow-up to restore green CI.

### Knowledge Stub — 18:19
- Created `app/services/knowledge/ingestion.stub.ts` to return zeroed metrics plus outstanding assumptions, loading the latest index metadata when available.
- Targeted lint: `npx eslint app/services/knowledge/ingestion.stub.ts` ✅

```bash
node -e "import('./app/services/knowledge/ingestion.stub.ts').then(m => m.ingestKnowledgeStub().then(res => console.log(JSON.stringify(res, null, 2))))"
```
```
{
  "status": "stub",
  "ready": false,
  "lastBuildAt": "2025-10-19T00:12:39.797Z",
  "metadata": {
    "generatedAt": "2025-10-19T00:12:39.797Z",
    "sources": [
      "docs/runbooks",
      "docs/enablement/job_aids",
      "docs/marketing/launch_faq.md",
      "docs/marketing/launch_comms_packet.md"
    ],
    "documentCount": 10,
    "llmModel": "gpt-4o-mini",
    "embeddingModel": "text-embedding-3-small",
    "usingMockProviders": false
  },
  "metrics": {
    "documentsIngested": 0,
    "chunksGenerated": 0,
    "embeddingsGenerated": 0
  },
  "assumptions": [
    "OpenAI embedding credentials are not yet approved; ingestion remains disabled.",
    "Content sources docs/enablement/job_aids, docs/marketing/launch_faq.md, docs/marketing/launch_comms_packet.md are missing from the repository."
  ],
  "notes": [
    "Last index build captured 10 document(s) using text-embedding-3-small.",
    "Index build uses production providers."
  ]
}
```

### Spec Update — 18:21
- Added `docs/specs/knowledge_pipeline.md` capturing the current build/eval state, outstanding blockers (missing sources, credential approvals), and next actions.

### Source Validator — 18:26
- Exported `DEFAULT_SOURCES` from `scripts/ai/build-llama-index.ts` (guarded CLI entrypoint to avoid side effects on import).
- Added `scripts/ai/validate-knowledge-sources.ts` to check for missing knowledge sources and exit non-zero if any are absent.
- Targeted lint: `npx eslint scripts/ai/validate-knowledge-sources.ts` ✅

```bash
npx tsx scripts/ai/validate-knowledge-sources.ts
```
```
{
  "timestamp": "2025-10-19T01:26:14.094Z",
  "totalSources": 4,
  "available": 1,
  "missing": 3,
  "reports": [
    {
      "source": "docs/runbooks",
      "absolutePath": "/home/justin/HotDash/hot-dash/docs/runbooks",
      "exists": true,
      "kind": "directory",
      "filesPresent": 11,
      "notes": [
        "Found 11 markdown file(s)."
      ]
    },
    {
      "source": "docs/enablement/job_aids",
      "absolutePath": "/home/justin/HotDash/hot-dash/docs/enablement/job_aids",
      "exists": false,
      "kind": "missing",
      "filesPresent": 0,
      "notes": [
        "Path does not exist."
      ]
    },
    {
      "source": "docs/marketing/launch_faq.md",
      "absolutePath": "/home/justin/HotDash/hot-dash/docs/marketing/launch_faq.md",
      "exists": false,
      "kind": "missing",
      "filesPresent": 0,
      "notes": [
        "Path does not exist."
      ]
    },
    {
      "source": "docs/marketing/launch_comms_packet.md",
      "absolutePath": "/home/justin/HotDash/hot-dash/docs/marketing/launch_comms_packet.md",
      "exists": false,
      "kind": "missing",
      "filesPresent": 0,
      "notes": [
        "Path does not exist."
      ]
    }
  ]
}
```

### Manager Update — 18:30
- Issues surfaced:
  1. Knowledge sources missing (`docs/enablement/job_aids`, `docs/marketing/launch_faq.md`, `docs/marketing/launch_comms_packet.md`).
  2. Global lint (`npm run lint`) fails with 472 legacy errors across ads/analytics/social/tests.
  3. `npm run test:ci` fails from integration test gaps (`social.api` lacks `authenticate` mock; `idea-pool` loader expects file URL).
- Requests to unblock next run:
  1. Have Content Ops land the missing source docs or provide alt paths so `DEFAULT_SOURCES` aligns with approved content.
  2. Assign owners for the repo-wide lint/test failures (or scope a waiver for knowledge lane until fixed).
  3. Confirm whether `scripts/ai/validate-knowledge-sources.ts` should join the standard preflight checklist so I can add it to runbook/CI.

### MCP Evidence Attempts — 20:06
- `codex exec --json -- "mcp shopify-admin {'action':'tools.list'}"` → initialization failed (HTTP 400). Evidence: `artifacts/ai-knowledge/2025-10-18/mcp/shopify-dev_tools.jsonl`.
- `codex exec --json -- "mcp context7 {'action':'tools.list'}"` → initialization failed (HTTP 400). Evidence: `artifacts/ai-knowledge/2025-10-18/mcp/context7_tools.jsonl`.
- Targeted lint: `npx eslint scripts/ai/build-llama-index.ts` ✅

### Shutdown — 21:04 (local time)

**Status**

- Task / Issue: #103 — PR: n/a — Branch: n/a
- DoD completion: Build/eval ✅; contract stub ✅; missing sources + global lint/test debt outstanding
- What changed since last entry:
  - Restored ingestion stub, documented pipeline state, and added source validation script.
  - Logged MCP attempts with evidence files despite remote initialization failures.
  - Captured lint/test gaps and requested manager follow-up.

**Evidence**

- Tests/logs/screens: `packages/memory/indexes/operator_knowledge/index_metadata.json`, `packages/memory/logs/build/eval/2025-10-19T0013/report.json`, `feedback/ai-knowledge/2025-10-18.md` (command logs), `docs/specs/knowledge_pipeline.md`
- Tool calls (MCP/adapters) used: Shopify DEV MCP (tools.list attempt), Context7 MCP (tools.list attempt)

**Blockers**

- Missing knowledge sources + repo-wide lint/test failures → **owner**: Manager to delegate (Content Ops / platform) — **ETA**: Pending direction

**Next-start plan (first 1–2 actions)**

1. Re-run `scripts/ai/validate-knowledge-sources.ts` once Content Ops delivers source docs; confirm index build ingests new material.
2. Replace placeholder eval set with approved Q/A and rerun `npm run ai:eval`, capturing metric deltas.

**Self-grade (1–5)**

- Progress vs DoD: 4
- Evidence quality: 5
- Alignment (North Star / Rules / Allowed paths): 5
- Tool discipline (MCP-first, no freehand, no secrets): 4 (remote MCP failures logged with evidence)
- Communication (feedback clarity & cadence): 4

**Retrospective**

- 2–3 things I did well today:
  1. Restored ingestion stub contract and documented the pipeline end-to-end.
  2. Captured reproducible logs/evidence for build, eval, and MCP attempts.
  3. Added tooling to surface missing sources proactively.
- 1–2 things to do differently tomorrow:
  1. Schedule MCP tool checks earlier to leave runway for retries.
  2. Automate eval metric comparison once real datasets arrive.
- **One thing I will stop entirely:** Deferring source validation until after builds; run the validator first.
