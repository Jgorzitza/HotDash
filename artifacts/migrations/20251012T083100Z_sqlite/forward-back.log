=== Prisma Migration Forward/Back Validation ===
Target: SQLite (dev.sqlite)
Date: 2025-10-10 14:40:25 UTC

[1/6] Creating backup: prisma/dev.sqlite.backup-20251010-084025
‚úÖ Backup created

[2/6] Checking current migration status...
npm warn Unknown project config "auto-install-peers". This will stop working in the next major version of npm.
npm warn Unknown project config "shamefully-hoist". This will stop working in the next major version of npm.
npm warn Unknown project config "enable-pre-post-scripts". This will stop working in the next major version of npm.
Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": SQLite database "dev.sqlite" at "file:dev.sqlite"

3 migrations found in prisma/migrations

Database schema is up to date!

[3/6] Listing applied migrations...
20251006100000_backfill_breach_metadata
20251005160022_add_dashboard_facts_and_decisions
20240530213853_create_session_table

[4/6] Testing migration reset (rollback to zero)...
npm warn Unknown project config "auto-install-peers". This will stop working in the next major version of npm.
npm warn Unknown project config "shamefully-hoist". This will stop working in the next major version of npm.
npm warn Unknown project config "enable-pre-post-scripts". This will stop working in the next major version of npm.
Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": SQLite database "dev.sqlite" at "file:dev.sqlite"

Applying migration `20240530213853_create_session_table`
Applying migration `20251005160022_add_dashboard_facts_and_decisions`
Applying migration `20251006100000_backfill_breach_metadata`

Database reset successful

The following migration(s) have been applied:

migrations/
  ‚îî‚îÄ 20240530213853_create_session_table/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20251005160022_add_dashboard_facts_and_decisions/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20251006100000_backfill_breach_metadata/
    ‚îî‚îÄ migration.sql

Running generate... (Use --skip-generate to skip the generators)
[2K[1A[2K[GRunning generate... - Prisma Client
[2K[1A[2K[G‚úî Generated Prisma Client (v6.16.3) to ./node_modules/@prisma/client in 102ms

‚úÖ Database reset successful (all migrations rolled back)

[5/6] Testing forward migration (reapply all)...
npm warn Unknown project config "auto-install-peers". This will stop working in the next major version of npm.
npm warn Unknown project config "shamefully-hoist". This will stop working in the next major version of npm.
npm warn Unknown project config "enable-pre-post-scripts". This will stop working in the next major version of npm.
Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": SQLite database "dev.sqlite" at "file:dev.sqlite"

3 migrations found in prisma/migrations


No pending migrations to apply.
‚úÖ All migrations reapplied successfully

[6/6] Verifying schema integrity...
npm warn Unknown project config "auto-install-peers". This will stop working in the next major version of npm.
npm warn Unknown project config "shamefully-hoist". This will stop working in the next major version of npm.
npm warn Unknown project config "enable-pre-post-scripts". This will stop working in the next major version of npm.
Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
The schema at prisma/schema.prisma is valid üöÄ
‚úÖ Schema validation passed

=== Final Migration Status ===
npm warn Unknown project config "auto-install-peers". This will stop working in the next major version of npm.
npm warn Unknown project config "shamefully-hoist". This will stop working in the next major version of npm.
npm warn Unknown project config "enable-pre-post-scripts". This will stop working in the next major version of npm.
Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": SQLite database "dev.sqlite" at "file:dev.sqlite"

3 migrations found in prisma/migrations

Database schema is up to date!

=== Database Structure Comparison ===
Backup tables:
DashboardFact       DecisionLog         Session             _prisma_migrations

Current tables:
DashboardFact       DecisionLog         Session             _prisma_migrations

=== Migration Rollback Test Complete ===
‚úÖ All migrations validated (forward + reset + forward)
üìÅ Backup preserved: prisma/dev.sqlite.backup-20251010-084025
üìù Archive this log under artifacts/qa/migration-test-20251010-084031.log

Next Steps:
1. Review migration status above
2. Validate data integrity (check Session, DashboardFact, DecisionLog tables)
3. Repeat test on Postgres staging when available
4. Share evidence with deployment and compliance agents
