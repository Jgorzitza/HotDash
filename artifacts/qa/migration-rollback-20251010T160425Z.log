=== Prisma Migration Forward/Back Validation ===
Target: SQLite (dev.sqlite)
Date: 2025-10-10 16:04:25 UTC

[1/6] Creating backup: prisma/dev.sqlite.backup-20251010-100425
✅ Backup created

[2/6] Checking current migration status...
Prisma schema loaded from prisma/schema.prisma
Datasource "db": SQLite database "dev.sqlite" at "file:dev.sqlite"

3 migrations found in prisma/migrations

Database schema is up to date!

[3/6] Listing applied migrations...
20251006100000_backfill_breach_metadata
20251005160022_add_dashboard_facts_and_decisions
20240530213853_create_session_table

[4/6] Testing migration reset (rollback to zero)...
Prisma schema loaded from prisma/schema.prisma
Datasource "db": SQLite database "dev.sqlite" at "file:dev.sqlite"

Applying migration `20240530213853_create_session_table`
Applying migration `20251005160022_add_dashboard_facts_and_decisions`
Applying migration `20251006100000_backfill_breach_metadata`

Database reset successful

The following migration(s) have been applied:

migrations/
  └─ 20240530213853_create_session_table/
    └─ migration.sql
  └─ 20251005160022_add_dashboard_facts_and_decisions/
    └─ migration.sql
  └─ 20251006100000_backfill_breach_metadata/
    └─ migration.sql

Running generate... (Use --skip-generate to skip the generators)
[2K[1A[2K[GRunning generate... - Prisma Client
[2K[1A[2K[G✔ Generated Prisma Client (v6.16.3) to ./node_modules/@prisma/client in 137ms

✅ Database reset successful (all migrations rolled back)

[5/6] Testing forward migration (reapply all)...
Prisma schema loaded from prisma/schema.prisma
Datasource "db": SQLite database "dev.sqlite" at "file:dev.sqlite"

3 migrations found in prisma/migrations


No pending migrations to apply.
✅ All migrations reapplied successfully

[6/6] Verifying schema integrity...
Prisma schema loaded from prisma/schema.prisma
The schema at prisma/schema.prisma is valid 🚀
✅ Schema validation passed

=== Final Migration Status ===
Prisma schema loaded from prisma/schema.prisma
Datasource "db": SQLite database "dev.sqlite" at "file:dev.sqlite"

3 migrations found in prisma/migrations

Database schema is up to date!

=== Database Structure Comparison ===
Backup tables:
DashboardFact       DecisionLog         Session             _prisma_migrations

Current tables:
DashboardFact       DecisionLog         Session             _prisma_migrations

=== Migration Rollback Test Complete ===
✅ All migrations validated (forward + reset + forward)
📁 Backup preserved: prisma/dev.sqlite.backup-20251010-100425
📝 Archive this log under artifacts/qa/migration-test-20251010-100431.log

Next Steps:
1. Review migration status above
2. Validate data integrity (check Session, DashboardFact, DecisionLog tables)
3. Repeat test on Postgres staging when available
4. Share evidence with deployment and compliance agents
